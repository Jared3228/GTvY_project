{% extends "base.html" %}

{% block content %}
<div class="page-header">
    <h1>Convenios</h1>
    <a href="{% url 'convenios:crear' %}" class="btn btn-primary">
        <ion-icon name="add-circle-outline"></ion-icon>
        Nuevo convenio
    </a>
</div>

<form method="get" class="filtros-convenios">
    <div class="filtro-group">
        <label for="id_orden">Ordenar por:</label>
        <select name="orden" id="id_orden">
            <option value="recientes" {% if orden == 'recientes' %}selected{% endif %}>
                Más recientes primero
            </option>
            <option value="antiguos" {% if orden == 'antiguos' %}selected{% endif %}>
                Más antiguos primero
            </option>
            <option value="pk_asc" {% if orden == 'pk_asc' %}selected{% endif %}>
                ID ascendente
            </option>
            <option value="pk_desc" {% if orden == 'pk_desc' %}selected{% endif %}>
                ID descendente
            </option>
        </select>
    </div>

    <label class="checkbox-inline">
        <input type="checkbox" name="inactivos" value="1"
               {% if inactivos %}checked{% endif %}>
        Incluir deshabilitados
    </label>

    <button type="submit" class="btn btn-secondary">
        <ion-icon name="filter-outline"></ion-icon>
        Aplicar filtros
    </button>
</form>

<div class="cards-grid">
    {% for convenio in convenios %}
        <a href="{% url 'convenios:detalle' convenio.pk %}"
          class="card 
          {% if convenio.expirado %}expirado{% endif %}
          {% if not convenio.activo %}inactivo{% endif %}">

            <div class="card-header">
                {% if convenio.expirado %}
                    <span class="estado-badge estado-expirado">Expirado</span>
                {% elif not convenio.activo %}
                    <span class="estado-badge estado-deshabilitado">Deshabilitado</span>
                {% else %}
                    <span class="estado-badge estado-vigente">Vigente</span>
                {% endif %}
                
                <h2 class="card-title">{{ convenio.nombre }}</h2>
            </div>

            <p class="card-meta">
                <strong>Firmado:</strong> {{ convenio.fecha_convenio|date:"d/m/Y" }}<br>
                <strong>Expira:</strong> 
                {% if convenio.fecha_expiracion %}
                    {{ convenio.fecha_expiracion|date:"d/m/Y" }}
                {% else %}
                    Indefinido
                {% endif %}
            </p>

        </a>
    {% empty %}
        <div class="no-results">
            <p>No hay convenios registrados que coincidan con los filtros.</p>
        </div>
    {% endfor %}
</div>
{% endblock %}
